---
import Layout from '../../layouts/Layout.astro';
import { getBadgeEmbedCode, BADGE_STYLES, BADGE_GROUPS, ORIGINAL_BADGE } from '../../lib/badge';

const slug = Astro.url.searchParams.get('slug') || '';
const siteUrl = Astro.locals.runtime.env.SITE_URL || 'https://nologin.tools';
const embedCode = getBadgeEmbedCode(slug, siteUrl, 'flat');
const allEmbedCodes = Object.fromEntries(
  [...BADGE_STYLES, ORIGINAL_BADGE].map((s) => [s.id, getBadgeEmbedCode(slug, siteUrl, s.id)])
);
---

<Layout
  title="Tool Submitted"
  description="Your tool has been submitted for review."
>
  <div class="max-w-2xl mx-auto px-6 py-16">
    <!-- Success message -->
    <div class="text-center mb-12">
      <div
        class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4"
      >
        <svg
          width="32"
          height="32"
          viewBox="0 0 32 32"
          fill="none"
        >
          <path
            d="M8 16L14 22L24 10"
            stroke="#22c55e"
            stroke-width="3"
            stroke-linecap="round"
            stroke-linejoin="round"></path>
        </svg>
      </div>
      <h1 class="text-3xl font-bold tracking-tight mb-2">
        Tool Submitted!
      </h1>
      <p class="text-neutral-500">
        Your tool has been submitted for review. We'll verify it and add it to
        the directory.
      </p>
    </div>

    <!-- Tool page link -->
    {slug && (
      <div class="bg-neutral-50 border border-neutral-200 rounded-lg p-4 mb-8">
        <p class="text-sm text-neutral-700 mb-2">
          Your tool page is available at:
        </p>
        <a
          href={`/tool/${slug}`}
          class="text-blue-600 hover:underline text-sm font-mono"
        >
          {siteUrl}/tool/{slug}
        </a>
        <p class="text-xs text-neutral-400 mt-1">
          The tool will appear in the public directory after review.
        </p>
      </div>
    )}

    <!-- Badge integration guide -->
    <div class="space-y-6">
      <h2 class="text-xl font-semibold text-neutral-950">
        Add the NoLogin Verified Badge
      </h2>
      <p class="text-sm text-neutral-500">
        Once approved, display the badge on your site to let users know your
        tool is verified. Tools with badges get higher visibility in the
        directory.
      </p>

      <!-- Badge Style Selector -->
      <div>
        <h3 class="text-sm font-medium text-neutral-700 mb-3">
          Choose Badge Style
        </h3>
        {BADGE_GROUPS.map((group) => {
          const groupStyles = BADGE_STYLES.filter((s) => s.group === group.id);
          const isDark = group.id === 'dark';
          return groupStyles.length > 0 && (
            <div class="mb-4">
              <p class="text-xs text-neutral-500 mb-2 font-medium uppercase tracking-wide">{group.label}</p>
              <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                {groupStyles.map((style) => (
                  <button
                    class:list={[
                      'badge-style-btn flex flex-col items-center justify-center gap-2 p-3 border rounded-lg transition-all cursor-pointer',
                      isDark ? 'bg-neutral-800' : '',
                      style.id === 'flat'
                        ? 'border-green-500 bg-green-50'
                        : 'border-neutral-200 hover:border-neutral-300',
                    ]}
                    data-style={style.id}
                    data-badge-path={style.path}
                    data-dark={isDark ? 'true' : undefined}
                  >
                    <img src={style.path} alt={style.label} class="inline-block" />
                    <span class:list={['text-xs', isDark ? 'text-neutral-300' : 'text-neutral-600']}>{style.label}</span>
                  </button>
                ))}
              </div>
            </div>
          );
        })}
        <p class="text-xs text-neutral-400 mb-6">
          Also available: <button class="badge-style-btn text-blue-600 hover:underline" data-style="original" data-badge-path={ORIGINAL_BADGE.path}>Original badge</button>
        </p>
      </div>

      <!-- SVG Badge -->
      <div>
        <div class="flex items-center justify-between mb-2">
          <h3 class="text-sm font-medium text-neutral-700">
            SVG Badge (Recommended)
          </h3>
          <button
            class="copy-btn text-xs text-blue-600 hover:underline"
            data-code="svg"
          >
            Copy
          </button>
        </div>
        <div class="mb-2">
          <img
            id="badge-preview"
            src="/badges/flat.svg"
            alt="NoLogin Verified"
            class="inline-block"
          />
        </div>
        <pre
          id="code-svg"
          class="bg-neutral-900 text-neutral-100 p-4 rounded-md text-xs overflow-x-auto"
        ><code>{embedCode.svg}</code></pre>
      </div>

      <!-- Meta tag -->
      <div>
        <div class="flex items-center justify-between mb-2">
          <h3 class="text-sm font-medium text-neutral-700">Meta Tag</h3>
          <button
            class="copy-btn text-xs text-blue-600 hover:underline"
            data-code="meta"
          >
            Copy
          </button>
        </div>
        <pre
          id="code-meta"
          class="bg-neutral-900 text-neutral-100 p-4 rounded-md text-xs overflow-x-auto"
        ><code>{embedCode.meta}</code></pre>
      </div>

      <!-- Text link -->
      <div>
        <div class="flex items-center justify-between mb-2">
          <h3 class="text-sm font-medium text-neutral-700">
            Footer Link
          </h3>
          <button
            class="copy-btn text-xs text-blue-600 hover:underline"
            data-code="link"
          >
            Copy
          </button>
        </div>
        <pre
          id="code-link"
          class="bg-neutral-900 text-neutral-100 p-4 rounded-md text-xs overflow-x-auto"
        ><code>{embedCode.link}</code></pre>
      </div>
    </div>

    <div class="mt-12 text-center">
      <a href="/" class="btn-secondary">Browse Tools</a>
    </div>

    <script id="embed-codes-data" type="application/json" set:html={JSON.stringify(allEmbedCodes)} />
  </div>

  <script>
    // Badge style switching
    const embedCodes: Record<string, { svg: string }> = JSON.parse(
      document.getElementById('embed-codes-data')!.textContent!
    );
    const styleBtns = document.querySelectorAll('.badge-style-btn');
    const badgePreview = document.getElementById('badge-preview') as HTMLImageElement;
    const codeSvg = document.getElementById('code-svg');

    styleBtns.forEach((btn) => {
      btn.addEventListener('click', () => {
        const style = (btn as HTMLElement).dataset.style!;
        const badgePath = (btn as HTMLElement).dataset.badgePath!;

        badgePreview.src = badgePath;

        if (codeSvg && embedCodes[style]) {
          codeSvg.innerHTML = `<code>${embedCodes[style].svg.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</code>`;
        }

        styleBtns.forEach((b) => {
          const el = b as HTMLElement;
          const isDark = el.dataset.dark === 'true';
          if (el.dataset.style === style) {
            el.classList.add('border-green-500');
            el.classList.remove('border-neutral-200', 'hover:border-neutral-300');
            if (!isDark) el.classList.add('bg-green-50');
          } else {
            el.classList.remove('border-green-500');
            el.classList.add('border-neutral-200', 'hover:border-neutral-300');
            if (!isDark) el.classList.remove('bg-green-50');
          }
        });
      });
    });

    // Copy to clipboard
    document.querySelectorAll('.copy-btn').forEach((btn) => {
      btn.addEventListener('click', () => {
        const codeId = `code-${(btn as HTMLElement).dataset.code}`;
        const codeEl = document.getElementById(codeId);
        if (codeEl) {
          navigator.clipboard.writeText(codeEl.textContent || '');
          btn.textContent = 'Copied!';
          setTimeout(() => {
            btn.textContent = 'Copy';
          }, 2000);
        }
      });
    });
  </script>
</Layout>
