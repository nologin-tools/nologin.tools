---
import { getAllTools } from '../../data/loader';
import BadgeDetailPage from '../../components/BadgeDetailPage.astro';

export function getStaticPaths() {
  const tools = getAllTools();
  return tools.map((tool) => ({
    params: { slug: tool.slug },
    props: { tool },
  }));
}

const { tool } = Astro.props;
const siteUrl = import.meta.env.SITE || 'https://nologin.tools';

// Convert build data to BadgeDetailPage prop format
const toolData = {
  id: tool.id,
  slug: tool.slug,
  name: tool.name,
  url: tool.url,
  coreTask: tool.coreTask,
  status: tool.status,
  approvedAt: tool.approvedAt,
};

const toolTags = tool.tags.map((t) => ({
  tagKey: t.tagKey,
  tagValue: t.tagValue,
}));

// Get latest health check from build data
const latestHealthRaw = tool.healthChecks[0] ?? null;
const latestHealth = latestHealthRaw
  ? { isOnline: latestHealthRaw.isOnline, checkedAt: new Date(latestHealthRaw.checkedAt) }
  : null;
---

<BadgeDetailPage
  tool={toolData}
  toolTags={toolTags}
  latestHealth={latestHealth}
  slug={tool.slug}
  siteUrl={siteUrl}
/>
