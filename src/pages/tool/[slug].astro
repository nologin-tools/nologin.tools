---
import { getAllTools } from '../../data/loader';
import ToolDetailPage from '../../components/ToolDetailPage.astro';

export function getStaticPaths() {
  const tools = getAllTools();
  return tools.map((tool) => ({
    params: { slug: tool.slug },
    props: { tool },
  }));
}

const { tool } = Astro.props;

// Convert build data to ToolDetailPage prop format
const toolData = {
  id: tool.id,
  slug: tool.slug,
  name: tool.name,
  url: tool.url,
  description: tool.description,
  coreTask: tool.coreTask,
  status: tool.status,
  approvedAt: tool.approvedAt,
  archiveUrl: tool.archiveUrl,
  isFeatured: tool.isFeatured,
  submitterEmail: tool.submitterEmail,
  twitterUrl: tool.twitterUrl,
  githubUrl: tool.githubUrl,
  discordUrl: tool.discordUrl,
  repoUrl: tool.repoUrl,
  githubStars: tool.githubStars,
  githubForks: tool.githubForks,
  githubLicense: tool.githubLicense,
  githubLanguage: tool.githubLanguage,
  githubUpdatedAt: tool.githubUpdatedAt,
  githubFetchedAt: tool.githubFetchedAt,
};

const toolTags = tool.tags.map((t) => ({
  tagKey: t.tagKey,
  tagValue: t.tagValue,
}));

// Convert health check date strings to Date objects
const recentChecks = tool.healthChecks.map((c) => ({
  isOnline: c.isOnline,
  httpStatus: c.httpStatus,
  responseTimeMs: c.responseTimeMs,
  checkedAt: new Date(c.checkedAt),
}));

const healthHistory = tool.healthHistory.map((h) => ({
  isOnline: h.isOnline,
  checkedAt: new Date(h.checkedAt),
}));
---

<ToolDetailPage
  tool={toolData}
  toolTags={toolTags}
  recentChecks={recentChecks}
  healthHistory={healthHistory}
  slug={tool.slug}
/>
